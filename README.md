# openevse-mqtt-mysql
Capture EV charging session connected with openEVSE
This project contains sources for capturing and processing data sent from OpenEVSE Wifi module to a MQTT service (Mosquitto). A Python script is used as a listener to MQTT topics to log charging sessions. The setup requires OpenEVSE Wifi, MQTT (Mosquito) and MySQL, and a web-server (I'm re-using the Apache web-server running EmonCMS, as well as the MariaDB).
As part of the configuration, OpenEVSE must publish data to MQTT.
The biggest part is to run the Python script as a listener and detecting the different states of the EV charging sessions. OpenEVSE Wifi regularly sends topics to MQTT (when configured on the Wifi end). The Python script subscribe to 2 of those: Wh (ie. energy transfered), and state (the charging status). What I discovered is about the concept of "session" for which, as long as the car is plugged, might draw energy from without resetting the energy counter. I named this as "delta session" in the python script. At end of each cycle, any situation where state goes from state 3 down to 2 or 1 (not higher, which is not considered), computes and logs an insert into MySQL. For each cycle logged data consists of end timestamp, energy (in WattSecond), duration, and few more (fixed ones). With such, the web-page lists all sessions along with totals (where applies).
